"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function trySplitting(e){currentRecipes=[],displayRecipes(),e&&window.setTimeout(function(){var t=p4gData.getSpecialFusionRecipe(e);if(t)return void displaySpecialRecipe(t);var n=p4gData.getDoubleFusionRecipes(e),r=p4gData.getTripleFusionRecipes(e);currentRecipes=n.concat(r),displayRecipes()},50)}function filterRecipes(e){var t=!0,n=!1,r=void 0;try{for(var a,i=function(){var t=a.value;e=e.filter(function(e){var n=e.some(function(e){return"persona"===t.type?e.name===t.value:e.arcana===t.value});return t.keep?n:!n})},l=getFilters()[Symbol.iterator]();!(t=(a=l.next()).done);t=!0)i()}catch(c){n=!0,r=c}finally{try{!t&&l["return"]&&l["return"]()}finally{if(n)throw r}}return e}function displayRecipes(){function e(e){o+=e,0>=o&&(o=0);var n=o+r;n>=a.length&&(n=a.length);var c=Math.ceil((1+o)/r);document.getElementById("pageInfo").textContent="Page "+c+" of "+s,i.prop("disabled",0===o),l.prop("disabled",n===a.length),$(t).find("tbody").remove();for(var u="<tbody>",p=o;n>p;p++){var d=a[p];u+=2===d.length?"<tr>"+getCellText(d[0])+getCellText(d[1])+"</tr>":"<tr>"+getCellText(d[0])+getCellText(d[1])+getCellText(d[2])+"</tr>"}u+="</tbody>",t.insertAdjacentHTML("beforeend",u)}enableFilters(currentRecipes.length>0);var t=document.getElementById("recipes"),n=$(document.getElementById("pageNav"));t.innerHTML="",n.hide();var r=ROWS_PER_PAGE,a=filterRecipes(currentRecipes);document.getElementById("recipesLegend").textContent="Recipes ("+a.length+")";var i=n.find("#prevPage"),l=n.find("#nextPage"),c="<thead><tr><th colspan='3'>Ingredients</th></tr></thead>";t.insertAdjacentHTML("beforeend",c),r<a.length&&(n.show(),i.click(function(){return e(-r)}),l.click(function(){return e(r)}));var s=Math.ceil(a.length/r),o=0;e(0)}function getCellText(e){return"<td>"+e.name+'<br/><span class="personaBasicDetails">( L'+e.level+" "+e.arcana+" )</span></td>"}function displaySpecialRecipe(e){enableFilters(!1);var t=document.getElementById("recipes");t.innerHTML="";var n="<thead><tr><th>Special Fusion - Ingredients</th></tr></thead>";t.insertAdjacentHTML("beforeend",n);var r="<tbody>";e.forEach(function(e){return r+="<tr>"+getCellText(e)+"</tr>"}),r+="</tbody>",t.insertAdjacentHTML("beforeend",r),document.getElementById("recipesLegend").textContent="Recipes (1)"}function enableFilters(e){var t=$(document.querySelectorAll("#filtersSection *"));t.prop("disabled",!e),t.toggleClass("disabled",!e)}function processFilterEdit(){function e(){var e=c&&c.find(function(e){return e.toUpperCase()===a.toUpperCase()}),t=s&&s.find(function(e){return e.toUpperCase()===a.toUpperCase()});return e&&!t?new Match(e,"arcana"):t&&!e?new Match(t,"persona"):null}function t(e,t){var n=e.filter(function(e){return e.toUpperCase().startsWith(t.toUpperCase())});return n.length>0?n:null}function n(e,t){var n=document.createElement("button");n.textContent=e,n.className=i?"filter-include":"filter-exclude",n.setAttribute("data-filterType",t),n.setAttribute("data-keep",i?"true":"false"),n.setAttribute("contenteditable","false"),n.addEventListener("click",function(){r.removeChild(n),displayRecipes()}),r.appendChild(n),document.getElementById("filterText").value="",displayRecipes()}var r=document.getElementById("filters"),a=document.getElementById("filterText").value,i=!0;("-"===a.charAt(0)||"."===a.charAt(0))&&(a=a.substr(1),i=!1);var l=!1;" "===a.charAt(a.length-1)&&(a=a.slice(0,-1),l=!0);var c=t(arcanas,a),s=t(personaNames,a);if(c||s){var o=(c?c.length:0)+(s?s.length:0);if(autoCompleteNames){if(1===o)c?n(c[0],"arcana"):n(s[0],"persona");else if(l){var u=e();u&&n(u.name,u.type)}}else{var u=e();if(!u)return;(l||1===o)&&n(u.name,u.type)}}}function getFilters(){var e,t,n,r,a,i,l;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:e=Array.from(document.getElementById("filters").children).filter(function(e){return e instanceof HTMLButtonElement}),t=!0,n=!1,r=void 0,c.prev=4,a=e[Symbol.iterator]();case 6:if(t=(i=a.next()).done){c.next=13;break}return l=i.value,c.next=10,new RecipeFilter(l.textContent,l.getAttribute("data-filterType"),"true"===l.getAttribute("data-keep"));case 10:t=!0,c.next=6;break;case 13:c.next=19;break;case 15:c.prev=15,c.t0=c["catch"](4),n=!0,r=c.t0;case 19:c.prev=19,c.prev=20,!t&&a["return"]&&a["return"]();case 22:if(c.prev=22,!n){c.next=25;break}throw r;case 25:return c.finish(22);case 26:return c.finish(19);case 27:case"end":return c.stop()}},_marked[0],this,[[4,15,19,27],[20,,22,26]])}function clearFilters(){document.getElementById("filters").innerHTML="",document.getElementById("filterText").value="",displayRecipes()}var _marked=[getFilters].map(regeneratorRuntime.mark),$=parent.$,p4gData=parent.p4gData,guiUtils=parent.guiUtils,ROWS_PER_PAGE=10,currentRecipes=[],autoCompleteNames=!1,infoWrapper=document.getElementById("personaInfo");guiUtils.populatePersonaList(infoWrapper,trySplitting,!0),document.getElementById("filterText").addEventListener("input",processFilterEdit),document.getElementById("clearFilters").addEventListener("click",clearFilters),document.getElementById("filtersWrapper").addEventListener("click",function(){return document.getElementById("filterText").focus()}),$(document.getElementById("autoCompSwitch")).click(function(){$(this).toggleClass("on"),autoCompleteNames=$(this).hasClass("on"),$(this).find(".switchText").text(autoCompleteNames?"on":"off"),autoCompleteNames&&processFilterEdit()}),$(function(){document.getElementById("autoCompSwitch").dispatchEvent(new Event("click")),displayRecipes()});var Match=function e(t,n){_classCallCheck(this,e),this.name=t,this.type=n},arcanas=p4gData.getAllArcanas(),personaNames=p4gData.getAllPersonas(!1).map(function(e){return e.name}),RecipeFilter=function t(e,n,r){_classCallCheck(this,t),this.value=e,this.type=n,this.keep=r};